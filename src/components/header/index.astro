---
import styles from './styles.module.css';
---

<header class={styles.header} id="main-header">
  <nav class={styles.nav}>
    <div class={styles.logoContainer} id="logo-container">
      <a href="/" class={styles.logoLink} aria-label="Ir a inicio">
        <img
          src="/logo-mobile.png"
          alt="Isaju - Catálogo de Peluches"
          class={styles.logo}
          id="header-logo"
        />
      </a>
    </div>

    <div class={styles.rightSection}>
      <div class={styles.branding}>
        <h1 class={styles.brandName}>Isaju</h1>
        <p class={styles.brandTagline}>Catálogo de Peluches</p>
      </div>
    </div>
  </nav>
</header>

<script>
  (function () {
    // Solo ejecutar handleScroll en la ruta raíz
    const currentPath = window.location.pathname;
    const logoContainer = document.getElementById('logo-container');
    const logoContainerEl = logoContainer;
    const logo = document.getElementById(
      'header-logo'
    ) as HTMLImageElement | null;
    logoContainerEl?.classList.add('logoMobile');
    if (currentPath !== '/') return;

    const header = document.getElementById('main-header');

    if (!header || !logoContainer || !logo) return;

    // TypeScript now knows these are not null after the check
    const headerEl = header;
    const logoEl = logo;

    function handleScroll() {
      if (window.scrollY > 200) {
        headerEl.classList.add('scrolled');
        logoContainerEl?.classList.add('scrolled');
        logoContainerEl?.classList.add('logoMobile');
        logoEl.src = '/logo-mobile.png';
      } else {
        headerEl.classList.remove('scrolled');
        logoContainerEl?.classList.remove('scrolled');
        logoContainerEl?.classList.remove('logoMobile');
        logoEl.src = '/logo.png';
      }
    }

    // Throttle scroll events for better performance
    let ticking = false;
    window.addEventListener('scroll', function () {
      if (!ticking) {
        window.requestAnimationFrame(function () {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    });

    handleScroll(); // Check initial state
  })();
</script>
